# ç”Ÿæ—¥è®°å½•ç®¡ç†å¹³å°

åŸºäº Next.js + Cloudflare Pages çš„ç”Ÿæ—¥è®°å½•ç®¡ç†ç³»ç»Ÿã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” ç®¡ç†å‘˜ç™»å½•éªŒè¯ï¼ˆbcrypt å¯†ç å“ˆå¸Œï¼‰
- ğŸ“ ç”Ÿæ—¥è®°å½•å¢åˆ æ”¹æŸ¥
- ğŸ¢ éƒ¨é—¨ç®¡ç†ï¼ˆæŸ¥çœ‹ã€åˆ é™¤éƒ¨é—¨åŠå¯¹åº”è®°å½•ï¼‰
- ğŸ“… å†œå†/å…¬å†ç”Ÿæ—¥æ”¯æŒ
- ğŸ‚ ä»Šæ—¥ç”Ÿæ—¥å±•ç¤º
- ğŸ”— å…¬å¼€çº¯æ–‡æœ¬ APIï¼Œä¾›å¤–éƒ¨ç¨‹åºå¯¹æ¥

## æ•°æ®æ ¼å¼

æ”¯æŒä»¥ä¸‹å››ç§æ ¼å¼ï¼š

```
# 1. å§“å - å¹´ - æœˆ-æ—¥-ç±»å‹ (å¸¦å¹´ä»½ä¸å¸¦éƒ¨é—¨)
å¼ ä¸‰ -1990-05-15-a

# 2. å§“å - æœˆ-æ—¥-ç±»å‹ (ä¸å¸¦å¹´ä»½ä¸å¸¦éƒ¨é—¨)
æå›› -08-20-a

# 3. å§“å - æœˆ-æ—¥-ç±»å‹-éƒ¨é—¨ (ä¸å¸¦å¹´ä»½å¸¦éƒ¨é—¨)
ç‹äº” -03-12-b-æŠ€æœ¯éƒ¨

# 4. å§“å - å¹´ - æœˆ-æ—¥-ç±»å‹-éƒ¨é—¨ (å¸¦å¹´ä»½å¸¦éƒ¨é—¨)
èµµå…­ -1985-12-01-a-å¸‚åœºéƒ¨
```

ç±»å‹è¯´æ˜ï¼š
- `a` = å…¬å†
- `b` = å†œå†

## éƒ¨ç½²æ­¥éª¤

### 1. åˆå§‹åŒ–é¡¹ç›®

```bash
npm install
```

### 2. ç”Ÿæˆç®¡ç†å‘˜å¯†ç å“ˆå¸Œ

```bash
npx bcrypt-cli hash "ä½ çš„å¯†ç "
```

ä¿å­˜è¾“å‡ºçš„å“ˆå¸Œå€¼ï¼Œåç»­é…ç½®åˆ° Cloudflare ç¯å¢ƒå˜é‡ã€‚

### 3. åˆ›å»º KV å‘½åç©ºé—´

```bash
wrangler kv:namespace create "BIRTHDAYS_KV"
```

è®°å½•è¾“å‡ºçš„ namespace IDã€‚

### 4. é…ç½® wrangler.toml

ç¼–è¾‘ `wrangler.toml` æ–‡ä»¶ï¼Œå°† `YOUR_KV_NAMESPACE_ID` æ›¿æ¢ä¸ºä¸Šä¸€æ­¥è·å–çš„ IDã€‚

### 5. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ Cloudflare Pages åå°è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

- `ADMIN_PASSWORD_HASH`: ç¬¬ 2 æ­¥ç”Ÿæˆçš„å¯†ç å“ˆå¸Œ
- `JWT_SECRET`: å¯é€‰ï¼Œç”¨äºä¼šè¯åŠ å¯†çš„å¯†é’¥

### 6. éƒ¨ç½²åˆ° Cloudflare Pages

#### æ–¹å¼ä¸€ï¼šé€šè¿‡ GitHub

1. å°†ä»£ç æ¨é€åˆ° GitHub ä»“åº“
2. åœ¨ Cloudflare Dashboard åˆ›å»º Pages é¡¹ç›®
3. å…³è” GitHub ä»“åº“
4. è®¾ç½®æ„å»ºé…ç½®ï¼š
   - æ¡†æ¶é¢„è®¾ï¼šNext.js
   - æ„å»ºå‘½ä»¤ï¼š`npm run build`
   - æ„å»ºè¾“å‡ºç›®å½•ï¼š`.next`
5. åœ¨"è®¾ç½®"ä¸­ç»‘å®š KV å‘½åç©ºé—´å’Œé…ç½®ç¯å¢ƒå˜é‡

#### æ–¹å¼äºŒï¼šä½¿ç”¨ Wrangler CLI

```bash
npm run deploy
```

### 7. åˆå§‹åŒ–ç”Ÿæ—¥æ•°æ®

éƒ¨ç½²å®Œæˆåï¼Œåœ¨ Cloudflare Dashboard çš„ KV å­˜å‚¨ä¸­æ‰‹åŠ¨æ·»åŠ é”®å€¼å¯¹ï¼š
- Key: `birthdays.txt`
- Value: åˆå§‹ç”Ÿæ—¥è®°å½•æ–‡æœ¬

## API æ¥å£

### ç®¡ç†æ¥å£ï¼ˆéœ€ç™»å½•ï¼‰

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/login | ç®¡ç†å‘˜ç™»å½• |
| DELETE | /api/login | é€€å‡ºç™»å½• |
| GET | /api/birthdays | è·å–ç”Ÿæ—¥è®°å½• |
| PUT | /api/birthdays | æ›´æ–°ç”Ÿæ—¥è®°å½• |
| GET | /api/departments | è·å–éƒ¨é—¨åˆ—è¡¨ |
| DELETE | /api/departments?name=xxx | åˆ é™¤éƒ¨é—¨ |
| GET | /api/today | è·å–ä»Šæ—¥ç”Ÿæ—¥ |

### å…¬å¼€æ¥å£ï¼ˆéœ€ API å¯†é’¥ï¼‰

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/public/birthdays?m=å¯†é’¥ | è¿”å›çº¯æ–‡æœ¬ birthdays.txt |

API å¯†é’¥åœ¨ç®¡ç†åå°çš„"API å¯†é’¥"æ ‡ç­¾é¡µä¸­ç”Ÿæˆå’Œç®¡ç†ï¼Œæ”¯æŒï¼š
- éšæœºç”Ÿæˆ 16 ä½å¯†é’¥
- è‡ªå®šä¹‰è®¾ç½®å¯†é’¥
- éšæ—¶é‡ç½®å¯†é’¥ï¼ˆæ—§å¯†é’¥ç«‹å³å¤±æ•ˆï¼‰
- åˆ é™¤å¯†é’¥ï¼ˆç¦ç”¨å…¬å¼€è®¿é—®ï¼‰

## Python å¯¹æ¥ç¤ºä¾‹

```python
import requests

# é…ç½®ä½ çš„ API å¯†é’¥
API_KEY = "your_16_char_api_key"

# è·å–ç”Ÿæ—¥è®°å½•
url = f'https://your-domain.pages.dev/api/public/birthdays?m={API_KEY}'
response = requests.get(url)

if response.status_code == 200:
    birthdays_text = response.text
    
    # è§£ææ•°æ®
    for line in birthdays_text.strip().split('\n'):
        parts = line.split('-')
        name = parts[0]
        print(f"{name} ç”Ÿæ—¥å¿«ä¹ï¼")
else:
    print(f"è¯·æ±‚å¤±è´¥ï¼š{response.status_code}")
    print(response.text)
```

## æœ¬åœ°å¼€å‘

```bash
npm run dev
```

æ³¨æ„ï¼šæœ¬åœ°å¼€å‘éœ€è¦é…ç½® KV å­˜å‚¨æ¨¡æ‹Ÿç¯å¢ƒã€‚

## ç›®å½•ç»“æ„

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”œâ”€â”€ birthdays/
â”‚   â”‚   â”‚   â”œâ”€â”€ departments/
â”‚   â”‚   â”‚   â”œâ”€â”€ today/
â”‚   â”‚   â”‚   â””â”€â”€ public/birthdays/
â”‚   â”‚   â”œâ”€â”€ (admin)/
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ (public)/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ session.ts
â”‚   â”‚   â”œâ”€â”€ parser.ts
â”‚   â”‚   â””â”€â”€ dateUtils.ts
â”‚   â”œâ”€â”€ components/
â”‚   â””â”€â”€ types/
â”œâ”€â”€ wrangler.toml
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

## è®¸å¯è¯

MIT
