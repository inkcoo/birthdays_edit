只要生成相应的代码文件目录，不要在本地运行npm等，只要代码结构正确，我会上传github如何用pages服务部署。

# 生日记录管理平台 - 实现逻辑与完整需求说明
## 一、项目核心需求
1. 部署环境：基于Cloudflare Pages + Functions服务，使用Next.js框架开发
2. 数据存储：通过Cloudflare KV存储空间管理生日记录，保持birthdays.txt纯文本格式
3. 核心功能：
   - 账户密码登录验证
   - 生日记录管理（增删改查）
   - 部门管理（查看、删除部门及对应记录）
   - 农历/公历切换查看生日
   - 展示当日生日人员名单
   - 提供公开的纯静态API密钥链接，输出纯文本格式的birthdays.txt内容，供Python程序对接
4. 数据格式要求：不修改birthdays.txt原始格式，所有操作均基于该格式完成

## 二、系统架构与实现逻辑
### 1. 整体架构
- 前端层：Next.js构建的静态页面，提供登录、管理界面、数据展示功能
- 接口层：Cloudflare Functions实现API接口，处理登录验证、KV存储操作、数据解析
- 存储层：Cloudflare KV命名空间，以单一键值对形式存储完整的birthdays.txt文本内容
- 对接层：公开的纯文本API接口，实时返回KV中存储的birthdays.txt内容

### 2. 核心逻辑流程
#### （1）数据存储逻辑
- KV命名空间中使用固定键名（birthdays.txt）存储完整的生日记录文本
- 所有管理操作最终都转化为对该KV键值的文本修改，保持原始格式不变
- 读取时从KV中获取完整文本，解析后展示；保存时将编辑后的文本重新写入KV

#### （2）登录验证逻辑
- 管理员密码通过bcrypt哈希处理后存储在Cloudflare环境变量中
- 登录接口接收密码参数，通过bcrypt对比哈希值完成验证
- 验证成功后前端设置登录态Cookie，未登录状态无法访问管理功能

#### （3）生日记录解析与展示逻辑
- 解析规则：按行分割文本，每行按"-"分割为「名称-月-日-类型[-部门]」格式
- 类型标识：a=公历、b=农历，其他可自定义
- 当日生日筛选：
  - 公历：获取当前系统日期的月/日，匹配对应记录
  - 农历：通过农历转换库将当前日期转为农历月/日，匹配对应记录
- 部门管理：从解析后的记录中提取所有部门名称，提供删除部门及对应记录的功能

#### （4）API接口逻辑
- 管理接口：需验证登录态，提供生日文本的读取和修改功能
- 公开纯文本接口：无需登录，直接返回KV中存储的birthdays.txt原始文本，支持Python程序对接

### 3. 部署逻辑
- Next.js项目配置静态导出模式，适配Cloudflare Pages部署要求
- 通过Wrangler工具或GitHub仓库关联，将项目部署到Cloudflare Pages
- 配置KV命名空间绑定、环境变量（密码哈希），确保接口可访问KV存储

## 三、功能模块说明
### 1. 登录模块
- 功能：密码验证、登录态管理、未登录跳转
- 安全要求：密码哈希存储，禁止明文传输和存储

### 2. 生日记录管理模块
- 功能：文本编辑、格式校验、保存到KV、实时读取
- 格式要求：「名称-年-月-日-类型[-部门]」的行式文本格式
-年份，类型，或部门可以有省略，不分类。
# 支持四种格式:
# 1. 姓名-年-月-日-类型 (带年份不带部门)
# 2. 姓名-月-日-类型 (不带年份不带部门)
# 3. 姓名-月-日-类型-部门 (不带年份带部门)
# 4. 姓名-年-月-日-类型-部门 (带年份带部门)

### 3. 部门管理模块
- 功能：提取所有部门列表、删除指定部门的所有记录
- 逻辑：通过解析文本中的部门字段，筛选去重生成部门列表；删除时过滤掉对应部门的记录行

### 4. 生日查询模块，还有相应的记录管理
- 功能：农历/公历切换、当日生日筛选、结果展示
- 核心：通过日期转换工具完成公历与农历的日期匹配

### 5. 公开API模块
- 功能：无权限验证，返回纯文本格式的birthdays.txt内容，参考https://github.com/inkcoo/birthdays_reminder/raw/refs/heads/main/birthdays.txt
- 用途：供外部Python程序对接，实时获取最新生日记录

## 四、部署与对接要求
### 1. Cloudflare部署要求
- 开通Pages、Functions、KV服务
- 创建KV命名空间并绑定到Pages项目
- 配置环境变量存储管理员密码哈希
- 确保Next.js项目以静态导出模式构建

### 2. Python程序对接要求
- 通过HTTP GET请求访问公开API链接
- 接收纯文本响应内容，按birthdays.txt格式解析数据
- 可定时请求接口获取最新生日记录

## 五、核心约束与规则
1. 数据格式约束：所有操作不得修改birthdays.txt的原始文本格式，仅做文本内容的增删改
2. 存储约束：仅使用Cloudflare KV作为唯一数据存储介质
3. 部署约束：必须适配Cloudflare Pages + Functions的运行环境
4. 接口约束：公开API必须返回纯文本格式，且内容与KV中存储的birthdays.txt实时同步
5. 安全约束：管理员密码必须哈希存储，管理功能需登录验证，禁止未授权访问